<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>JS逆向案例——利用插桩分析某音X-Bogus参数 | 何仕鹏的个人博客 | healthy,weathy,freedom,lucky,happy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="逆向,JS,插桩,某音,JSVMP">
    <meta name="description" content="免责声明：本文章中所有内容仅供学习交流，抓包内容、敏感网址、数据接口均已做脱敏处理，严禁用于商业用途和非法用途，否则由此产生的一切后果均与作者无关，若有侵权，请联系我立即删除！  逆向目标 目标：抖音网页端用户信息接口 X-Bogus 参数 接口：aHR0cHM6Ly93d3cuZG91eWluLmNvbS9hd2VtZS92MS93ZWIvdXNlci9wcm9maWxlL290aGVyLw&#x3D;">
<meta property="og:type" content="article">
<meta property="og:title" content="JS逆向案例——利用插桩分析某音X-Bogus参数">
<meta property="og:url" content="http://example.com/JS%E9%80%86%E5%90%91%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E5%88%A9%E7%94%A8%E6%8F%92%E6%A1%A9%E5%88%86%E6%9E%90%E6%9F%90%E9%9F%B3-X-Bogus%E5%8F%82%E6%95%B0/index.html">
<meta property="og:site_name" content="何仕鹏的个人博客">
<meta property="og:description" content="免责声明：本文章中所有内容仅供学习交流，抓包内容、敏感网址、数据接口均已做脱敏处理，严禁用于商业用途和非法用途，否则由此产生的一切后果均与作者无关，若有侵权，请联系我立即删除！  逆向目标 目标：抖音网页端用户信息接口 X-Bogus 参数 接口：aHR0cHM6Ly93d3cuZG91eWluLmNvbS9hd2VtZS92MS93ZWIvdXNlci9wcm9maWxlL290aGVyLw&#x3D;">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305252156680.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305252207875.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305252216469.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261417734.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261422288.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261427437.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261428075.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261431539.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261436393.png">
<meta property="og:image" content="http://example.com/Users/bird/Library/Application%20Support/typora-user-images/image-20230526144901346.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261510813.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261515928.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261551155.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261552244.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261602515.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261623527.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261624606.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261617354.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261619216.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261732876.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261734456.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261752479.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261902505.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261907302.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261924397.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261931435.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261940806.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261947393.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305262034511.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305262027010.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305262036070.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305262039875.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305262239713.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305262354871.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305270001806.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305270013473.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305270026360.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305272007042.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305270131778.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305270149851.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305270150962.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305271210612.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305271317166.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305271334889.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305281654744.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305291449033.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305222343422.png">
<meta property="article:published_time" content="2023-05-25T10:43:27.000Z">
<meta property="article:modified_time" content="2023-06-02T12:41:09.967Z">
<meta property="article:author" content="拾光的碎羽">
<meta property="article:tag" content="逆向">
<meta property="article:tag" content="JS">
<meta property="article:tag" content="插桩">
<meta property="article:tag" content="某音">
<meta property="article:tag" content="JSVMP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305252156680.png">
    
        <link rel="alternate" type="application/atom+xml" title="何仕鹏的个人博客" href="/atom.xml">
    
    <link rel="shortcut icon" href="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202205092054351.png">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202205092044923.jpeg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202205092042366.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">拾光的碎羽</h5>
          <a href="mailto:1615433864@qq.com" title="1615433864@qq.com" class="mail">1615433864@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/atom.xml" target="_blank" >
                <i class="icon icon-lg icon-feed"></i>
                RSS
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">JS逆向案例——利用插桩分析某音X-Bogus参数</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">JS逆向案例——利用插桩分析某音X-Bogus参数</h1>
        <h5 class="subtitle">
            
                <time datetime="2023-05-25T10:43:27.000Z" itemprop="datePublished" class="page-time">
  2023-05-25
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/JS%E9%80%86%E5%90%91/">JS逆向</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%80%86%E5%90%91%E7%9B%AE%E6%A0%87"><span class="post-toc-number">1.</span> <span class="post-toc-text">逆向目标</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%80%86%E5%90%91%E8%BF%87%E7%A8%8B"><span class="post-toc-number">2.</span> <span class="post-toc-text">逆向过程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%88%86%E6%9E%90"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">基本分析</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%8F%92%E6%A1%A9%E5%88%86%E6%9E%90"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">插桩分析</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%88%86%E6%9E%90%E7%AC%AC%E4%B8%83%E7%BB%84%E5%AD%97%E7%AC%A6%E5%A6%82%E4%BD%95%E7%94%9F%E6%88%90"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">分析第七组字符如何生成</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%88%86%E6%9E%90%E7%AC%AC%E5%85%AD%E7%BB%84%E5%AD%97%E7%AC%A6%E5%A6%82%E4%BD%95%E7%94%9F%E6%88%90"><span class="post-toc-number">2.2.2.</span> <span class="post-toc-text">分析第六组字符如何生成</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%A1%AB%E4%B9%8B%E5%89%8D%E7%9A%84%E5%9D%91"><span class="post-toc-number">2.2.3.</span> <span class="post-toc-text">填之前的坑</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%88%86%E6%9E%90%E4%B9%B1%E7%A0%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A6%82%E4%BD%95%E7%94%9F%E6%88%90"><span class="post-toc-number">2.2.4.</span> <span class="post-toc-text">分析乱码字符串如何生成</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%8A%A8%E6%80%81%E6%95%B0%E7%BB%84%E6%88%90%E5%91%98%E5%88%86%E6%9E%90"><span class="post-toc-number">2.2.5.</span> <span class="post-toc-text">动态数组成员分析</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%BF%90%E8%A1%8C%E4%B8%8E%E6%B5%8B%E8%AF%95"><span class="post-toc-number">3.</span> <span class="post-toc-text">运行与测试</span></a></li></ol>
        </nav>
    </aside>


<article id="post-JS逆向案例——利用插桩分析某音-X-Bogus参数"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">JS逆向案例——利用插桩分析某音X-Bogus参数</h1>
        <div class="post-meta">
            <time class="post-time" title="2023-05-25 18:43:27" datetime="2023-05-25T10:43:27.000Z"  itemprop="datePublished">2023-05-25</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/JS%E9%80%86%E5%90%91/">JS逆向</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <blockquote>
<p>免责声明：<strong>本文章中所有内容仅供学习交流，抓包内容、敏感网址、数据接口均已做脱敏处理，严禁用于商业用途和非法用途，否则由此产生的一切后果均与作者无关，若有侵权，请联系我立即删除！</strong></p>
</blockquote>
<h2 id="逆向目标"><a href="#逆向目标" class="headerlink" title="逆向目标"></a>逆向目标</h2><ul>
<li>目标：抖音网页端用户信息接口 X-Bogus 参数</li>
<li>接口：<code>aHR0cHM6Ly93d3cuZG91eWluLmNvbS9hd2VtZS92MS93ZWIvdXNlci9wcm9maWxlL290aGVyLw==</code></li>
<li>参数：<ul>
<li>X-Bogus: DFSzswVYwR2ANJV5ttm-TDok&#x2F;RBL</li>
<li>msToken: XdvBn3ow8atTxF5IT6Nozn_D976Sh-fQQais1pUkC0U-…3iUKTT_yGo4Q1A9KBUXxYALyw&#x3D;&#x3D;</li>
<li>ttwid: 1%7CwRK6LHw2rKAyHM8EeD4WLyVctABf-…5f35595a6e1f587dcc9f09b4fe</li>
</ul>
</li>
</ul>
<p>虽然接口入参有很多，但是实际上必不可少且需要逆向的就只有X-Bogus，msToken和Cookie中的ttwid。本文主要介绍X-Bogus的逆向，关于msToken和ttwid，后续会发文。</p>
<h2 id="逆向过程"><a href="#逆向过程" class="headerlink" title="逆向过程"></a>逆向过程</h2><h3 id="基本分析"><a href="#基本分析" class="headerlink" title="基本分析"></a>基本分析</h3><p>首先抓包定位到我们需要的接口，如图：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305252156680.png" alt="image-20230525215645569" style="zoom: 50%;" />



<p>这个请求是一个XHR请求，我们打上一个XHR断点，选择URL中包含X-Bogus，然后刷新页面重新请求主页，如图：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305252207875.png" alt="image-20230525220757801" style="zoom:50%;" />



<p>成功打上了断点，并且此时已经生成了msToken和X-Bogus参数。往前跟栈，来到一个叫 webmssdk.js 的 JS 文件，这里就是生成参数的主要 JS 逻辑了，也就是 JSVMP，整体上做了一个混淆如图：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305252216469.png" alt="image-20230525221623399" style="zoom: 40%;" />



<p>我们用<a target="_blank" rel="noopener" href="https://lyy077.github.io/JS%E9%80%86%E5%90%91%E7%A5%9E%E5%99%A8v-jstools%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/">v_jstools</a>做一个简单的还原，还原之后用浏览器的override功能替换，之后重新加载，如图：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261417734.png" alt="image-20230526141726633" style="zoom:30%;" />



<p>往上跟栈到w，如图：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261422288.png" alt="image-20230526142257188" style="zoom: 50%;" />

<p>可以看到w是一个数组，此时X-Bogus已经生成。</p>
<p>console控制台看下其长度为28，X-Bogus长度是否固定为28？我们不妨在这个地方设置一个条件断点，让它的长度为28的时候断一下，如下图：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261427437.png" alt="image-20230526142744359" style="zoom: 50%;" />



<p>断上之后有一个黄色的?标志，如图：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261428075.png" alt="image-20230526142839973" style="zoom:50%;" />



<p>刷新发现成功断上，此时console中继续查看X-bogus长度，发现果然是28位，如下图：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261431539.png" alt="image-20230526143132427" style="zoom:50%;" />

<p>并且X-bogus每次都是不一样的。</p>
<p>继续往上跟栈，来到一个符号函数，如图：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261436393.png" alt="image-20230526143653303" style="zoom:33%;" />

<p>这个符号函数就是JSVMP的初始化函数，这些参数就是字节码和函数机址等。</p>
<p>在最后一行打上断点，单步向下，发现这里就是生成X-Bogus的地方，如图：</p>
<img src="/Users/bird/Library/Application%20Support/typora-user-images/image-20230526144901346.png" alt="image-20230526144901346" style="zoom:33%;" />

<p>可以看到w函数就是调用入口。</p>
<p>接着往上跟栈，如图：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261510813.png" alt="image-20230526151040677" style="zoom:50%;" />

<p>可以看到这里的b是一个数组，包含了X-Bogus。</p>
<p>接着往上跟栈，如图：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261515928.png" alt="image-20230526151501816" title="">
                </div>
                <div class="image-caption">image-20230526151501816</div>
            </figure>

<p>前面一个三元表达式是字节系常见的环境检测，判断window对象的类型检测，检测是否在浏览器环境中运行，如果global只在node环境中才有，如果补环境的话需要注意这个检测。后边有一个webrt，在巨量或者头条里面，这里直接就写的jsvmprt了。jsvmp构建了一个运行js的vm，它有个最大的特点，就是一长串的字节码。</p>
<h3 id="插桩分析"><a href="#插桩分析" class="headerlink" title="插桩分析"></a>插桩分析</h3><p>前面说过，$符号函数就是JSVMP初始化的地方，而w方法就是调用入口，我们抠出w方法看下，如下：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261551155.png" alt="image-20230526155100064" style="zoom:50%;" />

<p>可以看到基本上整个流程就是在2个大的if分支中走动，这个y控制走哪个分支，y是什么呢？看下调用w的地方：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261552244.png" alt="image-20230526155236144" style="zoom:50%;" />

<p>可以看到y是一个布尔值，为0或者1。</p>
<p>单步调试的话会发现代码会一直走这个 <code>if-else</code> 的逻辑，几乎每一步都有O数组的参与，不断往里面增删改查值，for循环里面的j值，决定着后续if语句的走向，这里也就是插桩的关键所在，如下图所示：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261602515.png" alt="image-20230526160229453" style="zoom:30%;" />



<p>接下来对if-else两个分支进行插桩，如下：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261623527.png" alt="image-20230526162308477" style="zoom:50%;" />

<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261624606.png" alt="image-20230526162412545" style="zoom:50%;" />

<p>说一下这个日志格式，位置1和2用来区分if和else分支，索引j和索引A为关键索引，所以需要打印出来，o数组转化成JSON字符串，方便查看内容。</p>
<p>简单说一下JSON.stringify传入的那个函数有什么作用。stringify方法原型为：<code>JSON.stringify(value[, replacer [, space]])</code>，如果 replacer 为函数，则 <code>JSON.stringify</code> 将调用该函数，并传入每个成员的键和值，在函数中可以对成员进行处理，最后返回处理后的值，如果此函数返回 undefined，则排除该成员，举个例子：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var a = <span class="punctuation">&#123;</span><span class="attr">&quot;k1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;v1&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;k2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;v2&quot;</span><span class="punctuation">&#125;</span>;</span><br><span class="line">var b = JSON.stringify(a<span class="punctuation">,</span> function(k<span class="punctuation">,</span> v) <span class="punctuation">&#123;</span></span><br><span class="line">  if (v === <span class="string">&quot;v2&quot;</span>) return <span class="string">&quot;changed&quot;</span>;</span><br><span class="line">  return v;</span><br><span class="line"><span class="punctuation">&#125;</span>)</span><br><span class="line">console.log(b);</span><br><span class="line"><span class="comment">// 输出&#123;&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;changed&quot;&#125;;</span></span><br></pre></td></tr></table></figure>



<p>接下来我们演示一下当 <code>value</code> 为 <code>window</code> 时，会发生什么：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261617354.png" alt="image-20230526161711289" style="zoom:50%;" />

<p>可以看到这里由于循环引用导致异常，要知道在插桩的时候，如果插桩内容有报错，就会导致不能正常输出日志，这样就会缺失一部分日志，这种情况我们就可以加个函数处理一下，让 value 为 window 的时候，JSON 处理的时候函数返回 undefined，排除该成员，其他成员正常输出，如下图所示：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261619216.png" alt="image-20230526161931160" style="zoom:50%;" />



<p>回到正题，插好桩之后，去掉其它无关的断点，然后刷新主页，console控制台就会一直打印日志，直到断点断住，如图：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261732876.png" alt="image-20230526173237747" style="zoom: 25%;" />



<p>保存日志并用编辑器打开，然后拉到最后一条日志，如下图：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261734456.png" alt="image-20230526173407372" style="zoom: 33%;" />

<p>可以看到X-Bogus已经生成。</p>
<h4 id="分析第七组字符如何生成"><a href="#分析第七组字符如何生成" class="headerlink" title="分析第七组字符如何生成"></a>分析第七组字符如何生成</h4><p>将X-Bogus每四个一组，分成七组，即：<code>DFSz swVY zpUA NJV5 tSwJ Rfok /RsR</code>。先来看看第七组字符也就是最后一组字符如何生成。</p>
<p>搜索X-Bogus第一次生成的位置，如下图：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261752479.png" alt="image-20230526175203397" style="zoom:33%;" />

<p>可以看到最后一个R是在索引j为10，索引A为714的地方生成的。</p>
<p>接下来根据这两个索引打下条件断点，位置为2则断点应该断在else分支中。然后索引j为10，索引A为714在编辑器中查找了一下匹配到很多，所以仅靠j和A并不能唯一确定。我们拷贝下来数组O，看下其内容：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261902505.png" alt="image-20230526190224415" style="zoom: 30%;" />



<p>最后一个元素o[7]为21，我们把这个条件带上，然后再打上条件断点：<code>j==10 &amp;&amp; A==714 &amp;&amp; O[7]==21</code>，然后刷新就断住了：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261907302.png" style="zoom:33%;" />



<p>单步往下走，断到这个地方：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261924397.png" alt="image-20230526192450285" style="zoom:100%;" />



<p>依次看下m，w还有S：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261931435.png" alt="image-20230526193146347" title="">
                </div>
                <div class="image-caption">image-20230526193146347</div>
            </figure>

<p>可以看到S初始值为5，w是在O的第5个位置索引，m是在O的第4个位置索引， 所以w&#x3D;O[5]，m&#x3D;O[4]，P方法是charAt方法。</p>
<p>从之前的日志中复制出数组O，然后调试：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261940806.png" alt="image-20230526194023688" style="zoom:50%;" />

<p>这个R刚好是生成的X-Bogus最后一个字符。</p>
<p>接下来看下24是怎么来的。一样的方法，找到前面一行日志：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305261947393.png" alt="image-20230526194739275" style="zoom:33%;" />



<p>重新打上条件断点<code>j==47 &amp;&amp; A==708 &amp;&amp; O[7]==21</code>，然后刷新，如下：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305262034511.png" alt="image-20230526203407368" title="">
                </div>
                <div class="image-caption">image-20230526203407368</div>
            </figure>



<p>断上之后，单步跟踪，跟到这里：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305262027010.png" alt="image-20230526202719857" title="">
                </div>
                <div class="image-caption">image-20230526202719857</div>
            </figure>



<p>看下O[S]，g以及O[S]&amp;g的值，如下：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305262036070.png" alt="image-20230526203636912" style="zoom:50%;" />



<p>回到日志，用3768920&amp;63正好是24。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305262039875.png" alt="image-20230526203908745" title="">
                </div>
                <div class="image-caption">image-20230526203908745</div>
            </figure>



<p>再看下上一行的63是如何生成的。依据同样的方法，单步运行到如下：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305262239713.png" alt="image-20230526223934546" style="zoom:50%;" />

<p>可以看到取F数组704的位置，其中F是一个大数组，F[704]刚好是63。</p>
<p>整理下到目前为止生成X-Bogus最后一个字符的逻辑：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">倒数第一个字符R</span><br><span class="line">F = [null,...9];</span><br><span class="line">str = &quot;Dkdpgh4ZKsQB80/Mfvw36XI1R25-WUAlEi7NLboqYTOPuzmFjJnryx9HVGcaStCe=&quot;</span><br><span class="line">F[704]         ----&gt; 63</span><br><span class="line">3768920&amp;63     ----&gt; 24</span><br><span class="line">str.charAt(24) ----&gt; &quot;R&quot;</span><br></pre></td></tr></table></figure>

<p>先挖个坑在这里，3768920这个数字怎么生成的先放着，下边会填坑。</p>
<p>x-bogus倒数第二个字符是s，去掉最后一个字符之后看看第一次出现的位置，按之前的方式单步跟踪，如下图：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305262354871.png" alt="image-20230526235442697" title="">
                </div>
                <div class="image-caption">image-20230526235442697</div>
            </figure>

<p>S为5，取出当前日志下的O数组，发现w为9，m依然为那固定的字符串<code>Dkdpgh4ZKsQB80/Mfvw36XI1R25-WUAlEi7NLboqYTOPuzmFjJnryx9HVGcaStCe=</code>，p方法也依然为charAt，得到的结果刚好是s。</p>
<p>接下来看下这个9，找到紧挨着的第一次出现9的上面一行，如图：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305270001806.png" alt="image-20230527000130596" title="">
                </div>
                <div class="image-caption">image-20230527000130596</div>
            </figure>



<p>同样的断点然后单步跟踪到相应的地方：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305270013473.png" alt="image-20230527001359345" title="">
                </div>
                <div class="image-caption">image-20230527001359345</div>
            </figure>

<p>可以看到O[S]是用通过右移运算得到，将日志中的576&gt;&gt;6刚好就是9。</p>
<p>再看6，方法一样，跟踪到如下地方：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305270026360.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>F依然是那个大数组，A是646，F[646]刚好为6。</p>
<p>用同样的方式，可以算出576是由3768920&amp;4032得出。而4032则是由F[A]得出，此时的A为638。</p>
<p>整理下到目前为止生成X-Bogus最后2个字符的逻辑：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">倒数第二个字符s</span><br><span class="line">F[638]        ----&gt; 4032</span><br><span class="line">3768920&amp;4032  ----&gt; 576</span><br><span class="line">F[646]        ----&gt; 6</span><br><span class="line">576 &gt;&gt; 6      ----&gt; 9</span><br><span class="line">str.charAt(9) ----&gt; &quot;s&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">倒数第一个字符R</span><br><span class="line">F = [null,...9];</span><br><span class="line">str = &quot;Dkdpgh4ZKsQB80/Mfvw36XI1R25-WUAlEi7NLboqYTOPuzmFjJnryx9HVGcaStCe=&quot;</span><br><span class="line">F[704]         ----&gt; 63</span><br><span class="line">3768920&amp;63     ----&gt; 24</span><br><span class="line">str.charAt(24) ----&gt; &quot;R&quot;</span><br></pre></td></tr></table></figure>



<p>用同样的方法，整理第七组剩下的两个字符R和&#x2F;：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">X-Bogus: DFSz swVY zpUA NJV5 tSwJ Rfok /RsR</span><br><span class="line">F = [null,...9];</span><br><span class="line">str = &quot;Dkdpgh4ZKsQB80/Mfvw36XI1R25-WUAlEi7NLboqYTOPuzmFjJnryx9HVGcaStCe=&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----------------------------------第7组 /RsR -------------------------------------</span><br><span class="line">F[498]           ----&gt; 16515072</span><br><span class="line">3768920&amp;16515072 ----&gt; 3670012</span><br><span class="line">3670016&gt;&gt;18      ----&gt; 18</span><br><span class="line">str.charAt(14)   ----&gt; &quot;/&quot;</span><br><span class="line"></span><br><span class="line">F[568]         ----&gt; 258048</span><br><span class="line">3768920&amp;258048 ----&gt; 98304</span><br><span class="line">98304&gt;&gt;12      ----&gt; 24</span><br><span class="line">str.charAt(24) ----&gt; &quot;R&quot;</span><br><span class="line"></span><br><span class="line">F[638]        ----&gt; 4032</span><br><span class="line">3768920&amp;4032  ----&gt; 576</span><br><span class="line">F[646]        ----&gt; 6</span><br><span class="line">576 &gt;&gt; 6      ----&gt; 9</span><br><span class="line">str.charAt(9) ----&gt; &quot;s&quot;</span><br><span class="line"></span><br><span class="line">F[704]         ----&gt; 63</span><br><span class="line">3768920&amp;63     ----&gt; 24</span><br><span class="line">str.charAt(24) ----&gt; &quot;R&quot;</span><br></pre></td></tr></table></figure>



<h4 id="分析第六组字符如何生成"><a href="#分析第六组字符如何生成" class="headerlink" title="分析第六组字符如何生成"></a>分析第六组字符如何生成</h4><p>同样的方法，逆向最需要的是耐心，整个过程就不贴了，直接贴结果，如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">X-Bogus: DFSz swVY zpUA NJV5 tSwJ Rfok /RsR</span><br><span class="line">F = [null,...9];</span><br><span class="line">str = &quot;Dkdpgh4ZKsQB80/Mfvw36XI1R25-WUAlEi7NLboqYTOPuzmFjJnryx9HVGcaStCe=&quot;</span><br><span class="line"></span><br><span class="line">----------------------------------第6组 Rfok -------------------------------------</span><br><span class="line">F[498]           ----&gt; 16515072</span><br><span class="line">6359425&amp;16515072 -----&gt; 6291456</span><br><span class="line">6291456&gt;&gt;18      ----&gt; 24</span><br><span class="line">str.charAt(24)   ----&gt; &quot;R&quot;</span><br><span class="line"></span><br><span class="line">F[568]         ----&gt; 258048</span><br><span class="line">6359425&amp;258048 ----&gt; 65536</span><br><span class="line">65536&gt;&gt;12      ----&gt; 12</span><br><span class="line">str.charAt(16) ----&gt; &quot;f&quot;</span><br><span class="line"></span><br><span class="line">F[638]         ----&gt; 4032</span><br><span class="line">6359425&amp;4032   ----&gt; 2432</span><br><span class="line">F[646]         ----&gt; 6</span><br><span class="line">2432&gt;&gt;6        ----&gt; 38</span><br><span class="line">str.charAt(38) ----&gt; &quot;o&quot;</span><br><span class="line"></span><br><span class="line">F[704]        ----&gt; 63</span><br><span class="line">6359425&amp;63    ----&gt; 1</span><br><span class="line">str.charAt(1) ----&gt; &quot;k&quot;</span><br></pre></td></tr></table></figure>

<p>每一个字符生成都有一个常数6359425，这个放在下边分析。</p>
<h4 id="填之前的坑"><a href="#填之前的坑" class="headerlink" title="填之前的坑"></a>填之前的坑</h4><p>之前挖过2个坑，现在来填坑，看看3768920和6359425这2个数字是怎么来的。同样为了节省篇幅，直接上分析结果：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">str2 = &quot;\u0002ÿ-%.(´7^�\u001e\u001a÷Ä±a\t�9�X&quot;</span><br><span class="line"></span><br><span class="line">str2.charCodeAt(18) ----&gt; 57</span><br><span class="line">F[320]              ----&gt; 16</span><br><span class="line">57&lt;&lt;16              ----&gt; 3735552</span><br><span class="line">str2.charCodeAt(19) ----&gt; 130</span><br><span class="line">F[386]              ----&gt; 8</span><br><span class="line">130&lt;&lt;8              ----&gt; 33280</span><br><span class="line">3735552|33280       ----&gt; 3768832</span><br><span class="line">str2.charCodeAt(20) ----&gt; 88</span><br><span class="line">88|3768832          ----&gt; 3768920</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">str2 = &quot;\u0002ÿ-%.(´7^�\u001e\u001a÷Ä±a\t�9�X&quot;</span><br><span class="line"></span><br><span class="line">str2.charCodeAt(15) ----&gt; 97</span><br><span class="line">F[320]              ----&gt; 16</span><br><span class="line">97&lt;&lt;16              ----&gt; 6356992</span><br><span class="line">str2.charCodeAt(16) ----&gt; 9</span><br><span class="line">F[386]              ----&gt; 8</span><br><span class="line">9&lt;&lt;8                ----&gt; 2304</span><br><span class="line">6356992|2304        ----&gt; 6359296</span><br><span class="line">str2.charCodeAt(17) ----&gt; 129</span><br><span class="line">129|6359296         ----&gt; 6359425</span><br></pre></td></tr></table></figure>



<p>填完坑这里再埋个坑，先不管这个乱码字符串怎么来的，就假设这个乱码字符串是一个永远不变的常量，我们后边再分析。到此第七组和第六组字符生成逻辑就全部分析完了。我们整理一下，然后对比一下这两组伪代码：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305272007042.png" alt="image-20230527200739957" title="">
                </div>
                <div class="image-caption">image-20230527200739957</div>
            </figure>

<p>将流程对比一下就可以发现，每个步骤F里面的取值都是一样的，这个可以直接写死，不同之处就在于最开始的 <code>charCodeAt()</code> 操作，也就是返回乱码字符串指定位置字符的Unicode编码，第7组依次是18、19、20，第6组依次是15、16、17，以此类推，第1组刚好是0、1、2。</p>
<p>还可以看到，每一组的逻辑都是一样的，我们就可以写个通用方法，依次生成七组字符串，最后拼接成完整的 <code>X-Bogus</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getXBogus</span>(<span class="params">originalString</span>)&#123;</span><br><span class="line">    <span class="comment">// 生成乱码字符串</span></span><br><span class="line">    <span class="keyword">var</span> garbledString = <span class="title function_">getGarbledString</span>(originalString);</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">XBogus</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">// 依次生成七组字符串</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;= <span class="number">20</span>; i += <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> charCodeAtNum0 = garbledString.<span class="title function_">charCodeAt</span>(i);</span><br><span class="line">        <span class="keyword">var</span> charCodeAtNum1 = garbledString.<span class="title function_">charCodeAt</span>(i + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">var</span> charCodeAtNum2 = garbledString.<span class="title function_">charCodeAt</span>(i + <span class="number">2</span>);</span><br><span class="line">      	<span class="comment">// 常数</span></span><br><span class="line">        <span class="keyword">var</span> baseNum = charCodeAtNum2 | charCodeAtNum1 &lt;&lt; <span class="number">8</span> | charCodeAtNum0 &lt;&lt; <span class="number">16</span>;</span><br><span class="line">        <span class="comment">// 依次生成四个字符</span></span><br><span class="line">        <span class="keyword">var</span> str1 = short_str[(baseNum &amp; <span class="number">16515072</span>) &gt;&gt; <span class="number">18</span>];</span><br><span class="line">        <span class="keyword">var</span> str2 = short_str[(baseNum &amp; <span class="number">258048</span>) &gt;&gt; <span class="number">12</span>];</span><br><span class="line">        <span class="keyword">var</span> str3 = short_str[(baseNum &amp; <span class="number">4032</span>) &gt;&gt; <span class="number">6</span>];</span><br><span class="line">        <span class="keyword">var</span> str4 = short_str[baseNum &amp; <span class="number">63</span>];</span><br><span class="line">        <span class="title class_">XBogus</span> += str1 + str2 + str3 + str4;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">XBogus</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="分析乱码字符串如何生成"><a href="#分析乱码字符串如何生成" class="headerlink" title="分析乱码字符串如何生成"></a>分析乱码字符串如何生成</h4><p>用同样的方法，找到这串乱码字符串第一次出现的地方：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305270131778.png" alt="image-20230527013146563" title="">
                </div>
                <div class="image-caption">image-20230527013146563</div>
            </figure>

<p>注意到这里位置变为1，断点需要断到if分支，数组O的长度也变了，变为22了，且最后一个元素为62，断点的时候要注意。此时条件断点为：<code>j==16 &amp;&amp; A==2038 &amp;&amp; O[22]==62</code>，单步跟踪如下：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305270149851.png" alt="image-20230527014949639" title="">
                </div>
                <div class="image-caption">image-20230527014949639</div>
            </figure>



<p>看下w，m以及P分别代表什么：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305270150962.png" alt="image-20230527015032765" style="zoom:50%;" />

<p>可以看到这里通过调用自定义的方法生成乱码字符串，传入的参数分别为2，255和另一串乱码。抠出这个方法如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_0x94582</span>(<span class="params">a, b, c</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">_0x86cb82</span>(a) + <span class="title function_">_0x86cb82</span>(b) + c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_0x86cb82</span>(<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>现在又产生了2，255以及新的乱码字符。先看看255如何生成：同理找到第一次255变为null的日志处：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305271210612.png" alt="image-20230527121043553" title="">
                </div>
                <div class="image-caption">image-20230527121043553</div>
            </figure>



<p>断点后单步跟踪：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305271317166.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>整理逻辑为：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a ----&gt; &quot;484...&quot;</span><br><span class="line">A ----&gt; 2020</span><br><span class="line">l = function(a, b) &#123;</span><br><span class="line">    return parseInt(&quot;&quot; + a[b] + a[b + 1], 16);</span><br><span class="line">&#125;</span><br><span class="line">T = l(a, A);</span><br><span class="line">O[S][T] ----&gt; 255</span><br></pre></td></tr></table></figure>



<p>同样看下2是如何生成的，方法不变，整理下逻辑为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a ----&gt; &quot;484...&quot;</span><br><span class="line">A ----&gt; 2012</span><br><span class="line">T = l(a, A)</span><br><span class="line">O[S][T] ----&gt; 2</span><br></pre></td></tr></table></figure>

<p>跟255的生成逻辑是一致的。</p>
<p>再看下乱码字符串<code>-%.(´7^\u001e\u001a÷Ä±a\t9X</code>如何生成：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305271334889.png" alt="image-20230527133421812" style="zoom:50%;" />

<p>整理逻辑为：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function _0x25788b(a, b) &#123;</span><br><span class="line">    for (var c, e = [], d = 0, t = &quot;&quot;, f = 0; f &lt; 256; f++) &#123;</span><br><span class="line">        e[f] = f;</span><br><span class="line">    &#125;</span><br><span class="line">    for (var r = 0; r &lt; 256; r++) &#123;</span><br><span class="line">        d = (d + e[r] + a.charCodeAt(r % a.length)) % 256, c = e[r], e[r] = e[d], e[d] = c;</span><br><span class="line">    &#125;</span><br><span class="line">    var n = 0;</span><br><span class="line">    d = 0;</span><br><span class="line">    for (var o = 0; o &lt; b.length; o++) &#123;</span><br><span class="line">        d = (d + e[n = (n + 1) % 256]) % 256, c = e[n], e[n] = e[d], e[d] = c, t += String.fromCharCode(b.charCodeAt(o) ^ e[(e[n] + e[d]) % 256]);</span><br><span class="line">    &#125;</span><br><span class="line">    return t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_0x25788b(&#x27;ÿ&#x27;, &quot;@\u0000\u0001\fÄdE?&#x27;Qdpu\u000eÔ\u001dÑ&gt;¨&quot;) ----&gt; &#x27;-%.(´7^\u001e\u001a÷Ä±a\t9X&#x27;</span><br></pre></td></tr></table></figure>



<p>整理下’ÿ’和”@\u0000\u0001\fÄdE?’Qdpu\u000eÔ\u001dÑ&gt;¨”的生成逻辑：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a                      ----&gt; 255 固定值</span><br><span class="line">String.fromCharCode(a) ----&gt; &#x27;ÿ&#x27;;</span><br><span class="line"></span><br><span class="line">function _0x398111(a, b, c, e, d, t, f, r, n, o, i, _, x, u, s, l, v, h, p) &#123;</span><br><span class="line">    var y = new Uint8Array(19);</span><br><span class="line">    return y[0] = a, y[1] = i, y[2] = b, y[3] = _, y[4] = c, y[5] = x, y[6] = e, y[7] = u,</span><br><span class="line">    y[8] = d, y[9] = s, y[10] = t, y[11] = l, y[12] = f, y[13] = v, y[14] = r, y[15] = h,</span><br><span class="line">    y[16] = n, y[17] = p, y[18] = o, String.fromCharCode.apply(null, y);</span><br><span class="line">&#125; ----&gt; &quot;@\u0000\u0001\fÄdE?&#x27;Qdpu\u000eÔ\u001dÑ&gt;¨&quot;</span><br></pre></td></tr></table></figure>

<p>_0x398111方法，看下入参：<code>[64,0.00390625,1,12,196,100,69,63,39,81,100,112,117,14,212,29,209,62,16]</code>，数组里面每一个value值可能是动态的，具体的每一个值接下来都会一一分析。</p>
<h4 id="动态数组成员分析"><a href="#动态数组成员分析" class="headerlink" title="动态数组成员分析"></a>动态数组成员分析</h4><p>分析数组<code>arr1 = [64,1,196,69,39,100,117,212,209,168,0.00390625,12,100,63,81,112,14,29,62]</code>生成规则，结果如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">62:   l(a, 1922)  ----&gt; T  (59) </span><br><span class="line">      O[S][T]     ----&gt; 62 (S=22)</span><br><span class="line">29:   l(a, 1914)  ----&gt; T  (57)</span><br><span class="line">      O[S][T]     ----&gt; 29 (S=21)</span><br><span class="line">14:   l(a, 1906)  ----&gt; T  (55)</span><br><span class="line">      O[S][T]     ----&gt; 14 (S=20)</span><br><span class="line">112:  l(a, 1898)  ----&gt; T  (53)</span><br><span class="line">      O[S][T]     ----&gt; 112 (S=19)</span><br><span class="line">81:   l(a, 1890)  ----&gt; T  (51)</span><br><span class="line">      O[S][T]     ----&gt; 81 (S=18)</span><br><span class="line">63:   l(a, 1882)  ----&gt; T  (49)</span><br><span class="line">      O[S][T]     ----&gt; 63 (S=17)</span><br><span class="line">100:  l(a, 1874)  ----&gt; T  (47)</span><br><span class="line">      O[S][T]     ----&gt; 100 (S=16)</span><br><span class="line">12:   l(a, 1866)  ----&gt; T  (45)</span><br><span class="line">      O[S][T]     ----&gt; 12 (S=15)</span><br><span class="line">0.00390625:	</span><br><span class="line">      l(a, 1858)  ----&gt; T  (43)</span><br><span class="line">      O[S][T]     ----&gt; 0.00390625 (S=14)</span><br><span class="line">168:  l(a, 1850)  ----&gt; T  (60)</span><br><span class="line">      O[S][T]     ----&gt; 168 (S=13)</span><br><span class="line">209:  l(a, 1842)  ----&gt; T  (58)</span><br><span class="line">      O[S][T]     ----&gt; 209 (S=12)</span><br><span class="line">212:  l(a, 1834)  ----&gt; T  (56)</span><br><span class="line">      O[S][T]     ----&gt; 212 (S=11)</span><br><span class="line">117:  l(a, 1826)  ----&gt; T  (54)</span><br><span class="line">      O[S][T]     ----&gt; 117 (S=10)</span><br><span class="line">100:  l(a, 1818)  ----&gt; T  (52)</span><br><span class="line">      O[S][T]     ----&gt; 100 (S=9)</span><br><span class="line">39:   l(a, 1810)  ----&gt; T  (50)</span><br><span class="line">      O[S][T]     ----&gt; 39 (S=8)</span><br><span class="line">69:   l(a, 1802)  ----&gt; T  (48)</span><br><span class="line">      O[S][T]     ----&gt; 69 (S=7)</span><br><span class="line">196:  l(a, 1794)  ----&gt; T  (46)</span><br><span class="line">      O[S][T]     ----&gt; 196 (S=6)</span><br><span class="line">1:    l(a, 1786)  ----&gt; T  (44)</span><br><span class="line">      O[S][T]     ----&gt; 1 (S=5)</span><br><span class="line">64:   l(a, 1778)  ----&gt; T  (42)</span><br><span class="line">      O[S][T]     ----&gt; 64 (S=4)</span><br></pre></td></tr></table></figure>

<p>不难看出这一段逻辑是将一个数组的奇数索引与偶数索引重新组成一个新的数组，arr1就是重组之后的数组。</p>
<p>将arr1重新排列，得到arr2为<code>arr2=[64,0.00390625,1,12,196,100,69,63,39,81,100,112,117,14,212,29,209,62,168]</code>。</p>
<p><strong>arr2的索引值从T&#x3D;42～T&#x3D;60，刚好长度为19</strong>。</p>
<p>接下来就是分析这个arr2数组了。方法依旧是一模一样，先看最后一个也就是索引为18的元素。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">168:</span><br><span class="line">O[S][T] ----&gt; 64 (T=42, arr2[42]) 64</span><br><span class="line">O[S][T] ----&gt; 0.00390625 (T=43, arr2[43]) 64^0.00390625 -----&gt; 64</span><br><span class="line">O[S][T] ----&gt; 1 (T=44, arr2[44]),    64^1    ----&gt; 65</span><br><span class="line">O[S][T] ----&gt; 12 (T=45, arr2[45]),   65^12   ----&gt; 77 </span><br><span class="line">O[S][T] ----&gt; 196 (T=46, arr2[46]),  77^196  ----&gt; 137</span><br><span class="line">O[S][T] ----&gt; 100 (T=47, arr2[47]),  137^100 ----&gt; 237</span><br><span class="line">O[S][T] ----&gt; 69 (T=48, arr2[48]),   237^69  ----&gt; 168</span><br><span class="line">O[S][T] ----&gt; 63 (T=49, arr2[49]),   168^63  ----&gt; 151</span><br><span class="line">O[S][T] ----&gt; 39 (T=50, arr2[50]),   151^39  ----&gt; 176</span><br><span class="line">O[S][T] ----&gt; 81 (T=51, arr2[51]),   176^81  ----&gt; 225</span><br><span class="line">O[S][T] ----&gt; 100 (T=52, arr2[52]),  225^100 ----&gt; 133</span><br><span class="line">O[S][T] ----&gt; 112 (T=53, arr2[53]),  133^112 ----&gt; 245</span><br><span class="line">O[S][T] ----&gt; 117 (T=54, arr2[54]),  245^117 ----&gt; 128</span><br><span class="line">O[S][T] ----&gt; 14 (T=55, arr2[55]),   128^14  ----&gt; 142	</span><br><span class="line">O[S][T] ----&gt; 212 (T=56, arr2[56]),  142^212 ----&gt; 90	</span><br><span class="line">O[S][T] ----&gt; 29 (T=57, arr2[57]),   90^29   ----&gt; 71</span><br><span class="line">O[S][T] ----&gt; 209 (T=58, arr2[58]),  71^209  ----&gt; 150</span><br><span class="line">O[S][T]	----&gt; 62 (T=59, arr2[59]),   150^62  ----&gt; 168</span><br></pre></td></tr></table></figure>

<p>看下逻辑，就是对arr2数组从前往后做位运算。代码为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr2.<span class="title function_">reduce</span>(<span class="keyword">function</span>(<span class="params">a, b</span>) &#123; <span class="keyword">return</span> a ^ b; &#125;)</span><br></pre></td></tr></table></figure>

<p>测试一下：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305281654744.png" style="zoom:50%;" />

<p>没有问题。</p>
<p>接着分析索引为14~17的元素的生成逻辑，伪代码如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">3558723902&gt;&gt;24 ----&gt; -44</span><br><span class="line">-44&amp;255        ----&gt; 212</span><br><span class="line"></span><br><span class="line">3558723902&gt;&gt;16 ----&gt; -11235</span><br><span class="line">-11235&amp;255     ----&gt; 29</span><br><span class="line"></span><br><span class="line">3558723902&gt;&gt;8 ----&gt; -2875951</span><br><span class="line">-2875951&amp;255  ----&gt; 209</span><br><span class="line"></span><br><span class="line">3558723902&gt;&gt;0  ----&gt; -736243394</span><br><span class="line">-736243394&amp;255 ----&gt; 62</span><br></pre></td></tr></table></figure>

<p>这四个元素生成逻辑大同小异，都是将固定数字<code>3558723902</code>经过2次位运算得到。</p>
<p>而这个固定字符<code>3558723902</code>是调用<code>_0x5bc542</code>生成的。抠出代码并微做调整如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_0x5bc542</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> canvas = <span class="title function_">createCanvas</span>(<span class="number">48</span>, <span class="number">16</span>);</span><br><span class="line">    <span class="keyword">var</span> e = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line">    e.<span class="property">font</span> = <span class="string">&quot;14px serif&quot;</span>;</span><br><span class="line">    e.<span class="title function_">fillText</span>(<span class="string">&quot;龘ฑภ경&quot;</span>, <span class="number">2</span>, <span class="number">12</span>);</span><br><span class="line">    e.<span class="property">shadowBlur</span> = <span class="number">2</span>;</span><br><span class="line">    e.<span class="property">showOffsetX</span> = <span class="number">1</span>;</span><br><span class="line">    e.<span class="property">showColor</span> = <span class="string">&quot;lime&quot;</span>;</span><br><span class="line">    e.<span class="title function_">arc</span>(<span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">    e.<span class="title function_">stroke</span>();</span><br><span class="line">    <span class="keyword">const</span> b = canvas.<span class="title function_">toDataURL</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> d = <span class="number">0</span>; d &lt; <span class="number">32</span>; d++) &#123;</span><br><span class="line">        a = <span class="number">65599</span> * a + b.<span class="title function_">charCodeAt</span>(a % b.<span class="property">length</span>) &gt;&gt;&gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用到了canvas库，需要安装依赖：<code>npm i canvas</code></p>
<p>然后分析索引为10～13的元素的生成逻辑，伪代码如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1685091598.763&gt;&gt;24 ----&gt; 100</span><br><span class="line">100&amp;255            ----&gt; 100</span><br><span class="line"></span><br><span class="line">1685091598.763&gt;&gt;16 ----&gt; 25712</span><br><span class="line">25712&amp;255          ----&gt; 112</span><br><span class="line"></span><br><span class="line">1685091598.763&gt;&gt;8 ----&gt; 6582389</span><br><span class="line">6582389&amp;255       ----&gt;	117</span><br><span class="line"></span><br><span class="line">1685091598.763&gt;&gt;0 ----&gt; 1685091598</span><br><span class="line">1685091598&amp;255    ----&gt;	14</span><br></pre></td></tr></table></figure>

<p>逻辑跟上边四个字符一样，只不过固定的字符串生成规则不一样，是由一个13位的时间戳&#x2F;1000得到。</p>
<p>索引为6～9和0～3的元素为定值。</p>
<p>最后分析下索引为4～5的元素：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">originalString为URL后边的请求字符串拼接</span><br><span class="line">_0x1f3b8d(md5(_0x1f3b8d(md5(originalString)))) ----&gt; uint8Array</span><br><span class="line">uint8Array[14] ----&gt; 196</span><br><span class="line">uint8Array[15] ----&gt; 100</span><br></pre></td></tr></table></figure>

<p><code>uint8Array</code>方法为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">_0x1f3b8d = <span class="keyword">function</span>(<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> _0x19ae48 = []; <span class="comment">//内容自己补</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> b = a.<span class="property">length</span> &gt;&gt; <span class="number">1</span>, c = b &lt;&lt; <span class="number">1</span>, e = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(b), d = <span class="number">0</span>, t = <span class="number">0</span>; t &lt; c; ) &#123;</span><br><span class="line">        e[d++] = _0x19ae48[a.<span class="title function_">charCodeAt</span>(t++)] &lt;&lt; <span class="number">4</span> | _0x19ae48[a.<span class="title function_">charCodeAt</span>(t++)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>到此乱码字符串的生成逻辑就完成了，总结下来就是X-Bogus会对params，form-data，user-agent，时间，canvas进行校验。</p>
<h2 id="运行与测试"><a href="#运行与测试" class="headerlink" title="运行与测试"></a>运行与测试</h2><p>运行结果如下：</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305291449033.png" alt="image-20230529144947847" style="zoom:33%;" />

<p>成功生成X-Bogus，通过生成的X-Bogus拿到博主主页数据。</p>
<p>若需要完整代码或者讨论，扫描加微信。</p>
<img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202305222343422.png" alt="image-20230517010053227" style="zoom:25%;" />

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2023-06-02T12:41:09.967Z" itemprop="dateUpdated">2023-06-02 20:41:09</time>
</span><br>


        
        关注微信公众号~~逆向一步步~~，第一时间获取更新文章的推送 <br/> 版权声明：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！
        
    </div>
    
    <footer>
        <a href="http://example.com">
            <img src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202205092042366.jpg" alt="拾光的碎羽">
            拾光的碎羽
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JS/" rel="tag">JS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JSVMP/" rel="tag">JSVMP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8F%92%E6%A1%A9/" rel="tag">插桩</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9F%90%E9%9F%B3/" rel="tag">某音</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%80%86%E5%90%91/" rel="tag">逆向</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://example.com/JS%E9%80%86%E5%90%91%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E5%88%A9%E7%94%A8%E6%8F%92%E6%A1%A9%E5%88%86%E6%9E%90%E6%9F%90%E9%9F%B3-X-Bogus%E5%8F%82%E6%95%B0/&title=《JS逆向案例——利用插桩分析某音X-Bogus参数》 — 何仕鹏的个人博客&pic=https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202205092042366.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://example.com/JS%E9%80%86%E5%90%91%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E5%88%A9%E7%94%A8%E6%8F%92%E6%A1%A9%E5%88%86%E6%9E%90%E6%9F%90%E9%9F%B3-X-Bogus%E5%8F%82%E6%95%B0/&title=《JS逆向案例——利用插桩分析某音X-Bogus参数》 — 何仕鹏的个人博客&source=专注于爬虫,机器学习,深度学习,算法,后端等领域的学习" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://example.com/JS%E9%80%86%E5%90%91%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E5%88%A9%E7%94%A8%E6%8F%92%E6%A1%A9%E5%88%86%E6%9E%90%E6%9F%90%E9%9F%B3-X-Bogus%E5%8F%82%E6%95%B0/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《JS逆向案例——利用插桩分析某音X-Bogus参数》 — 何仕鹏的个人博客&url=http://example.com/JS%E9%80%86%E5%90%91%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E5%88%A9%E7%94%A8%E6%8F%92%E6%A1%A9%E5%88%86%E6%9E%90%E6%9F%90%E9%9F%B3-X-Bogus%E5%8F%82%E6%95%B0/&via=http://example.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://example.com/JS%E9%80%86%E5%90%91%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E5%88%A9%E7%94%A8%E6%8F%92%E6%A1%A9%E5%88%86%E6%9E%90%E6%9F%90%E9%9F%B3-X-Bogus%E5%8F%82%E6%95%B0/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/JS%E9%80%86%E5%90%91%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E6%9F%90%E9%9F%B3X-Bogus%E5%8F%82%E6%95%B0%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E4%B9%8B%E8%A1%A5%E7%8E%AF%E5%A2%83/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">JS逆向案例——某音X-Bogus参数逆向分析之补环境</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/JS%E9%80%86%E5%90%91%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E6%9E%81%E9%AA%8C%E6%97%A0%E6%84%9F%E9%AA%8C%E8%AF%81%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">JS逆向案例——极验无感验证逆向分析</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'eb07520a302f5438d2f9',
          clientSecret: 'dcd2e7c80f28c206cd938c3d2f4317bc45bc3adf',
          repo: 'lyy077.github.io',
          owner: 'lyy077',
          admin: ['lyy077'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢宝贝~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202205100208236.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202205100208236.jpg" data-alipay="https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202205100209914.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>拾光的碎羽 &copy; 2021 - 2023</span>
            <span>
                
                <a href="http://www.miitbeian.gov.cn/" target="_blank">鄂ICP备2022001140号</a><br>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://example.com/JS%E9%80%86%E5%90%91%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E5%88%A9%E7%94%A8%E6%8F%92%E6%A1%A9%E5%88%86%E6%9E%90%E6%9F%90%E9%9F%B3-X-Bogus%E5%8F%82%E6%95%B0/&title=《JS逆向案例——利用插桩分析某音X-Bogus参数》 — 何仕鹏的个人博客&pic=https://raw.githubusercontent.com/lyy077/blg-pic/main/pic/202205092042366.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://example.com/JS%E9%80%86%E5%90%91%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E5%88%A9%E7%94%A8%E6%8F%92%E6%A1%A9%E5%88%86%E6%9E%90%E6%9F%90%E9%9F%B3-X-Bogus%E5%8F%82%E6%95%B0/&title=《JS逆向案例——利用插桩分析某音X-Bogus参数》 — 何仕鹏的个人博客&source=专注于爬虫,机器学习,深度学习,算法,后端等领域的学习" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://example.com/JS%E9%80%86%E5%90%91%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E5%88%A9%E7%94%A8%E6%8F%92%E6%A1%A9%E5%88%86%E6%9E%90%E6%9F%90%E9%9F%B3-X-Bogus%E5%8F%82%E6%95%B0/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《JS逆向案例——利用插桩分析某音X-Bogus参数》 — 何仕鹏的个人博客&url=http://example.com/JS%E9%80%86%E5%90%91%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E5%88%A9%E7%94%A8%E6%8F%92%E6%A1%A9%E5%88%86%E6%9E%90%E6%9F%90%E9%9F%B3-X-Bogus%E5%8F%82%E6%95%B0/&via=http://example.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://example.com/JS%E9%80%86%E5%90%91%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E5%88%A9%E7%94%A8%E6%8F%92%E6%A1%A9%E5%88%86%E6%9E%90%E6%9F%90%E9%9F%B3-X-Bogus%E5%8F%82%E6%95%B0/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAT4AAAE+CAAAAAAxUyPsAAAFSklEQVR42u3awQ7iRhAE0P3/n95IuUUboKrarKLs8wmBscdvkOipnh8/4uPn38ev77w68uv8erXk/Vefvr/Oq9fJyE8HPnz48OHDV0K8H2Iy3AQon6QE8f3rfBo+EOPDhw8fPnwT3/siY/uz/xkcCfq9qGrLncQEHz58+PDh+zZfXhzkx6WIySOJhB4fPnz48OH7r/Hln/7+rsIWWyQRCT58+PDhw/cNviSsz2+Th+BJ0JA31PPmesv6QK8DHz58+PDhe3Rp/X96/eN7VRU+fPjw4fuD+X5OR1tGbEFDXty8f5ZLcfbhW/jw4cOHD9/k0C6G801j+ZK7vWbevM8b/Mk1o2Hhw4cPHz58E18+uPz8y30vm8+2KCSabHz48OHDhy/mS5bQ+eXuLfO8Bb7VD+2UfJhafPjw4cOHr+RL/uAv28jeE7QNgEs5sl2t2N+HDx8+fPjwBXxtE7otYpKSaAvZLy35fCI/aODDhw8fPnwT32WZ3W5QuxRMF4Jt4j/8dPDhw4cPH74D36XUaMudp8qILeJv2wYfIgN8+PDhw4cv5qtbwsEDb+F4Eg20rfccfWvM48OHDx8+fO142hZ1W7JsUXhyhZz40mD4ECjgw4cPHz58E1/y8O3Sun2kNp64hBSXMeDDhw8fPnxP8SW33NrkbdDfPupWPLU/mjqxwIcPHz58+KaIPD+nHe5TIcWlWGmLoX+8gw8fPnz48JV84x92+fB5s7xtmeeFSL5xrR4zPnz48OHDt4y5DsQvUXsy0ARim6TL+y9Hgg8fPnz48AV87TK+3Uy2heOXmP4SwSft9n9JXPDhw4cPH76Yr43gk+HeY4V261tyZvLp2MLHhw8fPnz44u/el+VbeVFH4fE5eYt9e64+isGHDx8+fPj2pfhlsb01vPOWdluOPHBffPjw4cOHb+JLIun7pq5to1idf5Tly2V68OHDhw8fvpavDeXzRXV7ne38pKhqi5I62sCHDx8+fPgOfN+L6e/RefvYbcNguzs+fPjw4cOX3z3/I88j77ZFveHmccM2YdE18eHDhw8fvpJviwDen9Nu6d7Ci6faDG1rPCp68OHDhw8fvrd8beGyceRxQz4BWws83yhQhPX48OHDhw9fcK+2dCg6AOfrb9vU6hotLsVeJi748OHDhw/fXntExUT7rXag95bAJdBvAwt8+PDhw4ev5cuxtvIlJ24b2G1Z85Ux4MOHDx8+fPEY2gh7W05vpc9Gs5VTIzc+fPjw4cO3/FNHDePk0nnBscXobRywTUn+A8KHDx8+fPgufO3f/D0g2B7gHhMkdx8PfPjw4cOHr8TKF/Pbp0n7+VJGPBX3R0+HDx8+fPjwTXyXxXkebbdH2zZoW/55yzxKWfDhw4cPH74zX47bRufvy4WtsMgnO+GOrowPHz58+PCVfEmbvI3v8wb81tJOzm+vkGfy+PDhw4cP3zf42uIgh7iUMjl9cpdtyn9s84APHz58+PDF27zaWPzCusXueTS/RQkvx48PHz58+PBNfE8VGU9F4Vsx8Y2w4MN38eHDhw8fvjPfUwF9G/rngf62vN+CCXz48OHDh+9ZvvqvOh7iU++0A81D+fy+208HHz58+PDhe/XdrbC4LN3zNnb+3XtJNBZq+PDhw4cP38SXFAHJzZ4qce4L9e253v+8XhYu+PDhw4cP32/hS0qHvPRJWu/fmKRL2YQPHz58+PB9jy9vIV8gtiA+D+UvQcOpcMGHDx8+fPjKsL7d5tUuwre7tAXKvTkx9jrw4cOHDx++Q/D91O23lvlTcf9WtJ329+HDhw8fvj+X7y+O5b6G+Vo+NgAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.js?v=1.7.2" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<!--<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>-->
<script async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>






<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
